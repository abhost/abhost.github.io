<!DOCTYPE HTML>

<html>
    <head>
        <meta charset="utf-8">

        <title>test</title>

    </head>

    <body style="background-color:#1a1a1a" onload="open()">
        <div style="text-align:center">
            <br>
        <img style="height:400px; border: 5px solid #383838;" id="image" src="no" alt="Placholder"><br>
        <label style="font-family:'Segoe UI'; color:white; font-size:25px" id="caption">Placeholder</label><br><br>
        <label style="font-family:'Segoe UI'; color:#c9c9c9; font-size:17px" id="info">Placeholder</label><br>
        <label style="font-family:'Segoe UI'; color:#c9c9c9" id="uploader">Placeholder</label><br><br>
        <button id="original" onclick="redirectoriginal()" onmouseover="changecolour()" onmouseleave="revertcolour()" style="border:0; border-radius:5px; cursor:pointer; background-color:#383838; color:white; width:175px; height:30px">See original image</button>
        <div>

 <script>
     
     function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
     
     let imagesrc = "placeholder";
           async function open(){

               var pageurl = window.location.href;
               var segment = pageurl.split('?');
               var url= segment[1];           
               imagesrc = url.replace(/!/g, '/');
               document.getElementById("image").src = imagesrc
               var captionunspaced = segment[2]
               var caption = captionunspaced.replace(/%20/g, ' ');               
               var uploadernameunspaced = segment[3]
               var uploadername = uploadernameunspaced.replace(/%20/g, ' ');
               var fullPath = document.getElementById("image").src;
               var filename = fullPath.substring(fullPath.lastIndexOf('/')+1);
               document.getElementById("caption").innerHTML = caption 
               document.getElementById("uploader").innerHTML = "<i>Uploaded by " + uploadername + "</i>"
               document.title = filename + " by " + uploadername;
               await sleep(1000);
               var sizewidth = document.getElementById("image").naturalWidth
               var sizeheight = document.getElementById("image").naturalHeight
               document.getElementById("info").innerHTML = "<i>" + filename + " [" + sizewidth + "px x " + sizeheight + "px]</i>"
               


            
           }

           function changecolour(){

              document.getElementById("original").style.backgroundColor = "#5e5e5e";
           }

           function revertcolour(){

               document.getElementById("original").style.backgroundColor = "#383838";
           }

           function redirectoriginal(){

               window.location.replace(imagesrc);
           }

        </script>
        
    </body>

</html>
